
<!DOCTYPE html>
<html lang="en">

<head>

    <meta name="keywords" content="Port, host, server, smtp, python, hacks, cyber security, management, mailing servers">
    <meta name="author" content="Moody">
    <meta name="copyright" content="Hossin azmoud">
    <meta name="robots" content="follow" />
    <meta name="description" content="sending emails using smtp server and python">
    <link rel="shortcut icon" href="../../imgs/icons/POPI.svg" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> How to send emails using python</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/script.js" defer></script>
    
</head>


<body>

<!-- <button id="FilterBTT"> click me </button>
 -->
<!-- Loading animation -->
    <div id="loading">
        <div class="container">
        <img src="../../imgs/icons/POPI.svg" alt="logo">
        <div id="LOAD" class="load">
        </div>
        </div>
    </div>    

<!-- Navbar -->

<nav class="nav">
    <img src="../../imgs/icons/POPI.svg">
    <a id="plink" href="https:\\Moodyy.netlify.com">Portfolio</a>
    <div class="links">
        <a href="https://twitter.com/Moody010111"><img src="../../imgs/icons/twitter.svg"></a>
        <a href="https://www.instagram.com/kunkingmoody"><img src="../../imgs/icons/insta.svg"></a>

    </div>
</nav>

<h2> How to send emails using Python </h2>


<ol class="tableOfContent">
        <li><a href="#whyEmail"> why emails </a></li>
        <li><a href="#settingup"> setting up </a></li>
        <li><a href="#1stImplemntation"> python implemntation to send one email </a></li>
        <li><a href="#UsingForLoops">sending multiple emails using a for loop </a></li>
        <li><a href="#usingfile"> sending multiple emails using a text file, csv file, json file </a></li>
        <li><a href="#attachData"> attaching binary data (images, pdfs, videos..) </a></li>   
</ol>


<div class="Content" id="whyEmail">
    <h3> why emails ?</h3>
    <p>
        why emails? you might ask, it is becasue emails are the best way to reach out people, because there is a better chance for you to check your emails than social media accounts.
so being as short as possible, let's illustrate this idea/strategy of advertising using python to send emails, instead of sending manually, let's imagine that you have a startup, that probably sells some product, books, softwares, perfumes, services or any product that can be sold, if you only work with the traditional way, you might make it if you only have 20 costumers, even in that case you will struggle, so what if you had 20k costumers ?
if we do the math and assumre that you copy and paste the same email over and over in 5s then sending the email to 20k people by your self will take you 20k*5s which is approximately 24 hours+ of work(stupid work), is not that riduclous?, over a day to send one only emails, so this is the thing, as your bussiness grows more, managing your startup or company will get more and more complex, so my point might be obvious by now since I walked you through the real world application.
by using python to send emails, you will reach out to your clients and advertise and announce thing easily, more effecient, also faster.
    </p>
</div>


<div class="Content" id="settingup">
    <h3> setting up </h3>
    <p>
       before even starting to type code, I am going to explain the library and the set up that we need to do, the first thing is that you really must have python installed  (v3.9 or higher) also you should have some python and terminal knowledge, also we are going to use the smtplib which is a built-in python module that uses the SMTP that stands for <span style="color:cyan;">
           Simple Mail Transfer Protocol
       </span> , and itâ€™s an application used by mail servers (Ex: hotmail, gmail etcetra...) to send, receive, and/or relay outgoing mail between email senders and receivers, second thing is knowing the port and host of the mailing server that you are using, wheather it is gmail or hotmail or yahoo, because each one of them uses diffrent <span class="keywords primary"> ports </span>, <span class="keywords primary"> hosts </span> urls (of course), configurations, and different user policies. for instance, gmail uses the port <span class="keywords sec"> 465 </span> and the host <span class="keywords sec">
           smtp.gmail.com
       </span> and sending gmail using python requires a key that is granted from the account's privacy settings, without that, python has no permssion to use the email even if you had the actual password, so to sammurize you should look up and do these things before starting
       <ul>
            <li style="margin: 10px 0;"> install python. </li>
           <li style="margin: 10px 0;"> the host, port of the mailing server. </li>
           <li style="margin: 10px 0;">get the key of your account, if it is a requirement, store it in an environement variable (for security purposes)</li>
           <li style="margin: 10px 0;">open a text editor  </li>
       </ul>
       also I would like to provide you with some of the information I have found about some mail servers thanks to this blog post: <span  style="display: inline;"><a style="display: inline;text-decoration: none; color: cyan;" href="https://sendgrid.com/blog/what-is-an-smtp-server/"> https://sendgrid.com/blog/what-is-an-smtp-server/ </a></span>
       <table>
        <tbody>
        <tr>
        <td><span style="font-weight: 400;">SMTP Provider</span></td>
        <td><span style="font-weight: 400;">URL</span></td>
        <td><span style="font-weight: 400;">SMTP host</span></td>
        </tr>
        <tr>
        <td><span style="font-weight: 400;">AOL</span></td>
        <td><span style="font-weight: 400;">aol.com</span></td>
        <td><span style="font-weight: 400;">smtp.aol.com</span></td>
        </tr>
        <tr>
        <td><span style="font-weight: 400;">AT&amp;T</span></td>
        <td><span style="font-weight: 400;">att.net</span></td>
        <td><span style="font-weight: 400;">smtp.mail.att.net</span></td>
        </tr>
        <tr>
        <td><span style="font-weight: 400;">Comcast</span></td>
        <td><span style="font-weight: 400;">comcast.net</span></td>
        <td><span style="font-weight: 400;">smtp.comcast.net</span></td>
        </tr>
        <tr>
        <td><span style="font-weight: 400;">iCloud</span></td>
        <td><span style="font-weight: 400;">icloud.com/mail</span></td>
        <td><span style="font-weight: 400;">smtp.mail.me.com</span></td>
        </tr>
        <tr>
        <td><span style="font-weight: 400;">Gmail</span></td>
        <td><span style="font-weight: 400;">gmail.com</span></td>
        <td><span style="font-weight: 400;">smtp.gmail.com</span></td>
        </tr>
        <tr>
        <td><span style="font-weight: 400;">Outlook</span></td>
        <td><span style="font-weight: 400;">outlook.com</span></td>
        <td><span style="font-weight: 400;">smtp-mail.outlook.com</span></td>
        </tr>
        <tr>
        <td><span style="font-weight: 400;">Yahoo</span></td>
        <td><span style="font-weight: 400;">mail.yahoo.com</span></td>
        <td><span style="font-weight: 400;">smtp.mail.yahoo.com</span></td>
        </tr>
        </tbody>
        </table>
    also if you have no idea how to get the port of your mail server provider you can consider
    the support page of your email service, but the most and usual used ports for this kind of service are 25, 465, 587, or 2525.
    </p>
</div>

<div class="Content" id="1stImplemntation">
    <h3> python implemntation to send one email </h3>
    <p>
        Now since you have configured everything we shall start coding the program to make it happen, I will use sublime text,, you can use whatever IDE you prefer because it is all the same, the thing that we must be worried about is the effeciency of the code not the IDE.
        so the first thing we should be doing is making a file, if you have a linux based os, then you can use the touch command to make a file <span class="keywords">main.py</span>, the second thing is as follows:
        <div class="code">
<span class="comment"> # Importing EmailMessage, to make the Message that will be sent.</span>
<span class="Pythonword">from </span> email.message <span class="Pythonword">import</span> EmailMessage
<span class="comment"># Importing the os lib to get the password, email from the env var.</span>
<span class="Pythonword"> from </span> os <span class="Pythonword">import</span> environ
<span class="comment"># import the smtplib which the built-in lib in python to send the email.</span>
<span class="Pythonword">import</span> smtplib
        </div>
        after applying this code you can now use alot of the functionality you need to send emails automatically.
        to explain this lines of code further more, I would illustrate it this way,
        the import word is a statement that tells python to invoke code from the python lib folder that is located in your laptop, in order to use this code in you script, also the lines that are highlighted in green are comments because a dash/# sign was prepended to the line.
        <p>
        so now you have all the stuff you need to start applying.
        </p>
        firstly you would consider defining the PORT, HOST, EMAIL, PASSWORD as follows:

        <div class="code">
            <span class="line"> 
                HOST  = <span class="green">  'smtp.gmail.com'</span>
            </span>
            <span class="line">
                PORT  = <span class="green">  465</span>
            </span>
            <span class="line"> 
                PASSWORD = os.<span class="function">getenviron(</span><span class="green">"MYPASSWORD"</span><span class="function">)</span>
            </span>
            <span class="line">
                EMAIL  = os.<span class="function">getenviron(</span><span class="green">"MYEMAIL"</span><span class="function">)</span>
            </span>
            <span class="line comment">
                # Note if the password and email are not stored in your env, then use them directly if you won't share the code with ant third-party website.
            </span>
        </div>
        after this was set and everything is okay, we shall invoke the EmailMessage object and store it in a variables then set the headers of our email message
        <div class="code">
            <span class="line comment"> # invoking the EmailMessage onbject</span>
            <span class="line">
                msg = <span class="functions">EmailMessage(</span><span class="functions">)</span>
            </span>
            <span class="line comment">
                # setting the headers
            </span>
            <span class="line">
                msg [<span class="green">"Subject"</span>] = <span class="green">'test'</span>
            </span>
            <span class="comment"># setting the reciever</span>
            <span class="line">
                msg [<span class="green">"To"</span>] = <span class="green">'EXample@gmail.com'</span>
            </span>
            <span class="comment"> # setting the sender which is me </span>
            <span class="line">
                msg [<span class="green">"From"</span>] = EMAIL
            </span>
            <span class="comment"># setting the content of the image</span>
                <span class="line">
                msg.<span class="functions">set_content(</span><span class="green"> 'hi, I am sending using python' </span><span class="functions">)</span>
                </span>
        </div>
        last but not least is sending the message using a context manager and the smtplib.SMTP_SSL():
        <div class="code">
            <span class="comment"> # the with, as are the context manager statments, and it is used for optimizing purposes, so the connection would be terminated after the task is done, because developers can be often in a hurry and forget to terminate the connexion </span>
            <span class="line">
                <span class="Pythonword">with</span> smtplib.<span class="functions">SMTP_SSL(HOST, PORT) </span><span class="Pythonword">as </span> S:
            </span>   
            <span class="comment">&emsp;&emsp;# loging in</span>
            &emsp;&emsp;S.<span class="functions">login(EMAIL, PASSWORD)</span>
            <span class="comment">&emsp;&emsp;# sending the messge</span>
            &emsp;&emsp;S.<span class="functions">send_message(EMAIL, PASSWORD)</span>
            <span class="line">
            &emsp;&emsp;<span class="functions">print(<span class="green">"the message was sent successfuly"</span>) </span>
            </span>
        </div>
    to generalize this code to be reusable we should wrap a function around it as follows:
    <div class="code">
        <span class="line"> 
            <span class="Pythonword">def</span> <span class="functions">&nbsp;SendEmail(<span style="color: lightyellow">HOST, PORT, SUBJECT,FROM, PASSWORD, TO, CONTENT</span>)</span>:
        </span>
        <span class="line comment"> &emsp;&emsp;# invoking the EmailMessage onbject</span>
            <span class="line">
                &emsp;&emsp;msg = <span class="functions">EmailMessage(</span><span class="functions">)</span>
            </span>
            <span class="line comment">
                &emsp;&emsp;# setting the headers
            </span>
            <span class="line">
                &emsp;&emsp;msg [<span class="green">"Subject"</span>] = <span class="green">SUBJECT</span>
            </span>
            <span class="comment">&emsp;&emsp;# setting the reciever</span>
            <span class="line">
                &emsp;&emsp;msg [<span class="green">"To"</span>] = <span class="green">TO</span>
            </span>
            <span class="comment"> &emsp;&emsp;# setting the sender which is me </span>
            <span class="line">
                &emsp;&emsp;msg [<span class="green">"From"</span>] = FROM
            </span>
            <span class="comment">&emsp;&emsp;# setting the content of the image</span>
                <span class="line">
                &emsp;&emsp;msg.<span class="functions">set_content(</span><span class="green"> CONTENT </span><span class="functions">)</span>
                </span>
             <span class="line">
                <span class="Pythonword"> &emsp;&emsp;with</span> smtplib.<span class="functions">SMTP_SSL(HOST, PORT) </span><span class="Pythonword">as </span> S:
            </span>
            <span class="line">
                &emsp;&emsp;&emsp;&emsp;S.<span class="functions">login(FROM, PASSWORD)</span>
            </span>
            <span class="line">
                    &emsp;&emsp;&emsp;&emsp;S.<span class="functions">send_message(msg)</span>    
            </span>
            <span class="line">
            &emsp;&emsp;&emsp;&emsp;<span class="functions">print(<span class="green">"the message was sent successfuly"</span>) </span>
            </span>
    </div>
    and this is how you send one email using smtplib.
    </p>
</div>

<div class="Content" id="UsingForLoops">
    <h3> sending multiple emails using a for loop </h3>
    <p>
        now if we want to send the same email to a sequence of other emails, we will firstly initialize a list that holds the email addresses the we are going to iterate over the list sending the same email to every email address
    <div class="code">
        <span class="line"> 
            emails = [<span class="green">"ex@gmail.com"</span>, <span class="green">"ex1@gmail.com"</span>, <span class="green">"ex2@gmail.com"</span>]
        </span>
        <span class="line">
            <span class="Pythonword">for</span> email <span class="Pythonword">
            in </span>emails:
        </span>
        <span class="comment">&emsp;# using the function we made don't forget to specify the args of the functions proprely or it won't work</span>
        <span class="line">

            &emsp;<span class="functions">SendEmail(<span style="color: lightyellow">HOST, PORT, SUBJECT,FROM, PASSWORD, email, CONTENT</span>)</span>
        </span>
    </div>
    you might want to send the emails to some data you have stored in some file (json, csv, txt), however it is too big, hence it would be stupid assigning it into a variable instead of reading the file and then using that data that was read from the file to send the email, so basically we will se how in the next section.
    </p>
</div>
<div class="Content" id="usingfile">
    <h3> sending multiple emails using a text file, csv file, json file </h3>
    <p>
        <h4>using a text file</h4>
        the structure of our data would be like:
        <div class="code">
            <span class="line">
                email1
            </span>
            <span class="line">
                email2
            </span>
            <span class="line">
                email3
            </span>
            <div class="line">        
            ......
            </div>
        </div>
        every line has an email so we can identify the emails one by one, using the <span class="keywords">open(FILENAME)</span> built-in function and the context manager we have seen before (if you don't want to use the context manager you can also close the file after you finish because leaving it open is not a good idea) to open the file, then to read every line we can use the readlines() method that returns an iterable of all the line that exist in the specified file.
        this is how we do it:
        <div class="code">
            <span class="line">
                <span class="Pythonword">with</span> <span class="functions">open("file.txt") </span><span class="Pythonword">as </span> file:
            </span>
            <span class="comment">
                # only iterating over the lines
            </span>
             <span class="line">
            <span class="Pythonword">&emsp;&emsp;for</span> email <span class="Pythonword">
            in </span>f.readlines():
        </span>
            <span class="line">
                &emsp;&emsp;&emsp;&emsp;print(email)
            </span>
        </div>
    the code above will just print the emails, but if you want to send something to all the emails you can use the method we made this way:
    <div class="code">
         <span class="Pythonword">for</span> email <span class="Pythonword">
            in </span>f.readlines():
        </span>
            
                <span class="comment">&emsp;&emsp;# instead ofprint(email)</span>
            <span class="functions">&emsp;&emsp;SendEmail(<span style="color: lightyellow">HOST, PORT, SUBJECT,FROM, PASSWORD, email, CONTENT</span>)</span>
            <span class="comment"># but remember to specify all the parameter of the function before calling it, I mean the start of you script is a good place.</span>
    </div>
    <h4>using a json file</h4>
        the structure of our data would be like:
        <div class="code">
            <pre>
{
    <span class="green">"emails"</span>: [<span class="green">"email1"</span>, <span class="green">"email2"</span>, <span class="green">"email3"</span>, <span style="color:red;">....</span>]
}
            </pre>
        </div>
        json is not formated the same as a text file, so we kind of going to treat it diffrently, we are going to firstly make an import statement to invoke some code to use on json as follows:
        <div class="code">
            <span class="line">
                <span class="Pythonword">from </span> json <span class="Pythonword">import</span> loads    
            </span>
        </div>
        so as you see, we will be using a function to decode  from json to a python dict data structure so we can use it as follows:
        <div class="code">
            <span class="comment"># we pass in an opened file</span>
            data = loads(open(<span class="green">"file.json"</span>).read())[<span class="green">"emails"</span>]
            <span class="comment">
                # now we have all the data in dict format now we iterate using  for loop
            </span>
            <span class="Pythonword">for</span> email <span class="Pythonword">
            in </span>data:
        </span>
                <span class="comment">&emsp;&emsp;# instead ofprint(email)</span>
            <span class="functions">&emsp;&emsp;SendEmail(<span style="color: lightyellow">HOST, PORT, SUBJECT,FROM, PASSWORD, email, CONTENT</span>)</span>
        </div>
        <h4> using a csv file </h4>
    when using csv file, you have two options, either use the text file's same approach, but step the first row (because it is the names of the columns), or use the read_csv class from pandas to make it easier and I recommend using this approach because it has more functionality, for some visual understanding this is how a csv file looks like:
    <div class="code">
        <span class="line">Emails</span>
        <span class="line">ex@gmail.com</span>
        <span class="line">ex0@gmail.com</span>
        <span class="line">ex1@gmail.com</span>
        <span class="line">ex2@gmail.com</span>
    </div>
    <p>but if you want understand more then look for csv file format.
    now, as I said I am going to clarify how to use the read_csv class from the pandas lib</p>
    firstly, we need to import the class from pandas
    <div class="code">
        <span class="line">
            <span class="Pythonword">from</span> pandas <span class="Pythonword">import</span> read_csv
        </span>
    </div>
    then after this we need to initiate the class with a file name passed as an argument
    <div class="code">
        <span class="comment"># Object initiation</span>
        <span class="line">
            Data = <span class="functions">read_csv(<span class="geen">"file.csv"</span>)</span>
        </span>
        <span class="comment">
            # mutating data to be useable dictionary using the method to_dict()
        </span>
        <span class="line">
            Data1 = Data.<span class="functions">to_dict()</span>
        </span>
        <span class="line">
            <span class="functions">print(<span class="green">Data1</span>)</span>
        </span>
    </div>
    <div class="code">
        <span class="line">the output of the last snippet of code:</span>
        <span class="line">{'emails': {0: ex@gmail.com, 1: ex0@gmail.com, 2: ex1@gmail.com, 3: ex2@gmail.com}}</span>
    </div>
    we have the data, but as you see above there is a problem, we still need to reformat it to what we wanted, so we will add somethings to make it more useable 
    <div class="code">
        Data1 = list(Data.<span class="functions">to_dict()</span>[<span class="green">"emails"</span>].values)
    </div>
         <div class="code">
        <span class="line">the output of the last snippet of code:</span>
        <span class="line">[ex@gmail.com, ex1@gmail.com, ex2@gmail.com, ex3@gmail.com]</span>
    </div>
    perfect, now we have a python list, we can just iterate over it using a simple for loop:
    <div class="code">
         <span class="Pythonword">for</span> email <span class="Pythonword">
            in </span>Data1:
        </span>
        <span class="functions line">&emsp;&emsp;SendEmail(<span style="color: lightyellow">HOST, PORT, SUBJECT,FROM, PASSWORD, email, CONTENT</span>)</span>
    </div>
    

    </p>
</div>

<div class="Content" id="attachData">
    <h3> attaching data, images, pdfs, docx </h3>
    <p>
        to attach anything to our email we have a special method in our EmailMessage object called add_attachement() that handles any binary data wheather it is a pdf file or docx file or an image.
        the overall concept is that we will open the file and dump its binary data as a parameter to the add_attachement() method, with all its informations.
        <p>in this example we will use an image.</p>
        <div class="code">
            <span class="comment"># first open the file</span>
            <span class="line"> 
                <span class="Pythonword">with</span> open("name.png", "rb") <span class="Pythonword">as</span>img:
            </span>
            <span class="line">
                &emsp;&emsp;fileData = img. <span class="functions">read()</span>
            </span>
            <span class="comment">&emsp;&emsp;# the extansion</span>
            <span class="line">
                &emsp;&emsp;fileType = "png"
            </span>
            <span class="line">
                &emsp;&emsp;fileName = "name.png" 
            </span>
            <span class="comment"># after the file is closed you can call the method passing the extracted data and other info</span>
            msg. <span class="functions">add_attachement(<span class="green">fileData, maintype="image", subtype=fileType, filename=fileName</span>)</span>
        </div>  
    </p>
</div>
<div class="Content">
    <span style="color:rgb(100, 100, 100);display: block;">Author: Moody</span>
    <span style="color:rgb(100, 100, 100);display: block;"> Date: 2021/12/07, 21:04</span>
    <span class="line" style="color:rgb(100, 100, 100);"> Note: not bad as a first post</span>
</div>
<footer>
    <a class="backHome" href="../../index.html"> back home</a>
</footer>
</body>
</html>         
